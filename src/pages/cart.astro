---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Shopping Cart">
	<h1>Shopping Cart</h1>
	<div id="cart-items"></div>
	<div id="cart-total"></div>
	<button id="clear-cart">Clear Cart</button>
	<a href="/products" class="continue-shopping">Continue Shopping</a>
	<button id="pay-button" class="pay-button">Pay</button>
</Layout>

<style>
	h1 {
		text-align: center;
		margin-bottom: 2rem;
	}
	#cart-items {
		margin-bottom: 2rem;
	}
	#cart-total {
		font-weight: bold;
		margin-bottom: 1rem;
	}
	button, .continue-shopping, .pay-button {
		display: inline-block;
		padding: 0.5rem 1rem;
		background-color: #333;
		color: white;
		text-decoration: none;
		border: none;
		border-radius: 4px;
		cursor: pointer;
		font-size: 1rem;
		margin-right: 1rem;
	}
	.continue-shopping {
		background-color: #4CAF50;
	}
	.pay-button {
		background-color: #f44336;
	}
</style>

<script>
	import { getCart, removeFromCart, clearCart } from '../scripts/cart';

	function updateCartDisplay() {
		const cartItems = getCart();
		const cartItemsElement = document.getElementById('cart-items');
		const cartTotalElement = document.getElementById('cart-total');
		const payButton = document.getElementById('pay-button');

		if (cartItems.length === 0) {
			cartItemsElement.innerHTML = '<p>Your cart is empty.</p>';
			cartTotalElement.textContent = '';
			payButton.style.display = 'none';
		} else {
			let cartHtml = '<ul>';
			let total = 0;
			cartItems.forEach(item => {
				cartHtml += `
					<li>
						${item.name} - $${item.price.toFixed(2)}
						<button class="remove-item" data-id="${item.id}">Remove</button>
					</li>
				`;
				total += item.price;
			});
			cartHtml += '</ul>';
			cartItemsElement.innerHTML = cartHtml;
			cartTotalElement.textContent = `Total: $${total.toFixed(2)}`;
			payButton.style.display = 'inline-block';

			// Add event listeners to remove buttons
			document.querySelectorAll('.remove-item').forEach(button => {
				button.addEventListener('click', (e) => {
					const id = parseInt(e.target.dataset.id);
					removeFromCart(id);
					updateCartDisplay();
				});
			});
		}
	}

	document.addEventListener('DOMContentLoaded', () => {
		updateCartDisplay();

		document.getElementById('clear-cart').addEventListener('click', () => {
			clearCart();
			updateCartDisplay();
		});

		document.getElementById('pay-button').addEventListener('click', () => {
			window.location.href = '/payment-methods';
		});
	});
</script>